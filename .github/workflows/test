name: test

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    permissions:
      contents: write

    steps:
     - name: Setup Inno Setup
       uses: Minionguyjpro/Inno-Setup-Action@v1.2.7

     - name: Check Inno Setup version
       run: |
         $chocoLibPath = "C:\ProgramData\chocolatey\lib"
         $innoDir = Get-ChildItem -Path $chocoLibPath -Filter "innosetup*" -Directory | Select-Object -First 1
         if ($innoDir) {
             # Chocolatey 安装的 Inno Setup 在 tools 子目录下有 iscc.exe
             $innoPath = Join-Path $innoDir.FullName "tools"
             $env:Path = "$innoPath;" + $env:Path
         }
         iscc /?
